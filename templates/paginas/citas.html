{% extends 'base/home.html' %}
{% load static %}
{% load widget_tweaks %}

{% block title %}<title>Citas</title>
{% endblock %} 
{% block content %}
    <h2>CITAS</h2>
    <p>Vista donde podra agendar y visualizar citas programadas</p>
{% endblock %}
{% block modulo %}
<div class="contenedor2">
    <div class="cita-btns">
        <li class="button {% if modo == 'agendar' %}active{% endif %}">
            <a href="?modo=agendar"><label>Agendar Cita</label></a>
        </li>
        <li class="button {% if modo == 'listar' %}active{% endif %}">
            <a href="?modo=listar" ><label>Ver Citas Programadas</label></a>
        </li>
    </div>
    
    <div class="contenedor-citas">
    {% if modo == "agendar" %}
    <h2>Agendar Cita</h2>

        <!-- IZQUIERDA -->
        <div class="lado-izq">
             <!-- BUSCAR ALUMNO -->
            <form method="GET" class="buscar-alumno-form">
            <input type="hidden" name="modo" value="agendar">
            <label>Buscar alumno (ID o nombre):</label>
            <input type="text" name="alumno_buscar" class="btn-editar"
           placeholder="ID o Nombre"
           value="{{ alumno_query }}">
            <button type="submit" class="btn-agendar">Buscar</button>
            </form>
    <form method="POST">
    {% csrf_token %}

    <div class="cita-grid">

            <h3>Alumno seleccionado</h3>

            {% if alumnos %}
                {% for a in alumnos %}
                <div class="alumno-card">
                    <p class="label">Nombre del alumno</p>
                    <p class="btn-editar">{{ a.NombreAlumno }} {{ a.ApellidoAlumno }}</p>

                    <p class="label">Edad</p>
                    <p class="btn-editar">{{ a.EdadAlumno }}</p>

                    <p class="label">Encargado</p>
                    <p class="btn-editar">{{ a.EncargadoAlumno }}</p>

                    <!-- Guardar el alumno elegido -->
                    <input type="hidden" name="alumno" value="{{ a.id }}">
                </div>
                {% endfor %}
            {% else %}
                <p>No hay alumno seleccionado. Use el buscador de arriba.</p>
            {% endif %}
        </div>

        <!-- DERECHA -->
        <div class="lado-der">

            <label for="id_personal">Especialista:</label>
            {{ form.personal|add_class:"input-text" }}

            <label for="id_fecha">Fecha:</label>
            {{ form.fecha|add_class:"btn-editar" }}

            <label for="id_hora">Hora:</label>
            {{ form.hora|add_class:"btn-editar" }}

            <label for="id_examen">Tipo de examen:</label>
            {{ form.examen|add_class:"btn-editar" }}

            <button type="submit" class="btn-agendar">Agendar Cita</button>
        </div>

    </div>
    </form>

    </div>
    {% else %}
    <h2 class="titulo-modulo">Citas Programadas</h2>
        <!-- FILTROS -->
        <form method="GET" class="filtros-form">
            <input type="hidden" name="modo" value="listar">
            <input type="date" name="fecha" value="{{ fecha }}" class="btn-editar">
            <input type="time" name="hora" value="{{ hora }}" class="btn-editar">
            <input type="text" name="alumno" placeholder="Alumno" value="{{ alumno }}" class="btn-editar">
            <input type="text" name="personal" placeholder="ID Personal" value="{{ personal }}" class="btn-editar">
            <button type="submit" class="button">
                <label>Filtrar</label>
            </button>
        </form>

        <!-- TABLA -->
        <table class="tabla-citas">
            <thead>
                <tr>
                    <th>Fecha</th>
                    <th>Hora</th>
                    <th>Alumno</th>
                    <th>Especialista</th>
                    <th>Examen</th>
                </tr>
            </thead>
            <tbody>
                {% for c in citas %}
                <tr>
                    <td>{{ c.fecha }}</td>
                    <td>{{ c.hora }}</td>
                    <td>{{ c.alumno.NombreAlumno }} {{ c.alumno.ApellidoAlumno }}</td>
                    <td>{{ c.personal.NombrePersonal }} {{ c.personal.ApellidoPersonal }}</td>
                    <td>{{ c.examen }}</td>
                </tr>
                {% empty %}
                <tr><td colspan="5">No hay citas programadas.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}
</div>
{% endblock %}
